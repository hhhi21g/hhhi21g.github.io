---

layout: post

title: 02-é¢„å¤‡çŸ¥è¯†

date: 2025-01-22 01:27:23 +0900

categories: [æ·±åº¦å­¦ä¹ ]
---

- [2.1  æ•°æ®æ“ä½œğŸŠ](#21--æ•°æ®æ“ä½œ)
  - [å¹¿æ’­æœºåˆ¶](#å¹¿æ’­æœºåˆ¶)
  - [ç´¢å¼•å’Œåˆ‡ç‰‡](#ç´¢å¼•å’Œåˆ‡ç‰‡)
  - [èŠ‚çœå†…å­˜:æ‰§è¡ŒåŸåœ°æ“ä½œ](#èŠ‚çœå†…å­˜-æ‰§è¡ŒåŸåœ°æ“ä½œ)
  - [ä¸å…¶ä»–pythonå¯¹è±¡çš„è½¬æ¢](#ä¸å…¶ä»–pythonå¯¹è±¡çš„è½¬æ¢)
- [2.2  æ•°æ®é¢„å¤„ç†](#22--æ•°æ®é¢„å¤„ç†)
- [2.3  çº¿æ€§ä»£æ•°](#23--çº¿æ€§ä»£æ•°)
  - [åŸºæœ¬æ•°å­¦å¯¹è±¡](#åŸºæœ¬æ•°å­¦å¯¹è±¡)
  - [å¼ é‡ç®—æ³•çš„åŸºæœ¬æ“ä½œ](#å¼ é‡ç®—æ³•çš„åŸºæœ¬æ“ä½œ)
  - [èŒƒæ•°](#èŒƒæ•°)
- [2.4  å¾®ç§¯åˆ†](#24--å¾®ç§¯åˆ†)
- [2.5  è‡ªåŠ¨å¾®åˆ†](#25--è‡ªåŠ¨å¾®åˆ†)
  - [æ ‡é‡å˜é‡çš„åå‘ä¼ æ’­](#æ ‡é‡å˜é‡çš„åå‘ä¼ æ’­)
  - [éæ ‡é‡å˜é‡çš„åå‘ä¼ æ’­](#éæ ‡é‡å˜é‡çš„åå‘ä¼ æ’­)
  - [åˆ†ç¦»è®¡ç®—](#åˆ†ç¦»è®¡ç®—)
- [2.6  æ¦‚ç‡](#26--æ¦‚ç‡)
  - [ä½¿ç”¨å®ä¾‹](#ä½¿ç”¨å®ä¾‹)
  - [ä¸€äº›æ¦‚å¿µ](#ä¸€äº›æ¦‚å¿µ)



### 2.1  æ•°æ®æ“ä½œğŸŠ

- `x = torch.arange(num)  # éé¢å¤–æŒ‡å®šï¼Œå¼ é‡å­˜å‚¨åœ¨å†…å­˜ï¼ŒåŸºäºCPUè®¡ç®—` 
- `x.shape`
- `x.numel()  # å¼ é‡ä¸­å…ƒç´ çš„æ€»æ•°`
- `x.reshape(num1,num2,...)`
- `torch.zeros((num1,num2,num3,...))`
- `torch.ones((num1,num2,num3,...))`
- `torch.randn(num1,num2)  # ä»å‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1çš„æ­£æ€åˆ†å¸ƒ(é«˜æ–¯åˆ†å¸ƒ)ä¸­éšæœºé‡‡æ ·` 
- `torch.rand()  # åŒ…å«ä»åŒºé—´(0,1)å‡åŒ€åˆ†å¸ƒä¸­æŠ½å–çš„ä¸€ç»„éšæœºæ•°`

------

- `x ** y  # xçš„yæ¬¡å¹‚`

- `torch.exp(x)`

- ```python
  X = torch.arange(12, dtype=torch.float32).reshape((3, 4))        # shape:[3,4]
  Y = torch.tensor([[2, 1, 4, 3], [1, 2, 3, 4], [4, 3, 2, 1]])     # shape:[3,4]
  print(torch.cat((X, Y), dim=0))                                  # shape:[6,4]
  print(torch.cat((X, Y), dim=1))                                  # shape:[3,8]
  ```

- `X == Y`

- `X.sum()  # å¯¹å¼ é‡ä¸­æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œ`    

------

#### å¹¿æ’­æœºåˆ¶

```python
[[0],                    [[0,0],    [[1,2],

 [1],  +  [[1,2]]  ---->  [1,1],  +  [1,2], 

 [2]]                     [2,2]]     [1,2]]
```

------

#### ç´¢å¼•å’Œåˆ‡ç‰‡

`X[-1],X[1:3]`

å¯ä»¥å†™å…¥

------

#### èŠ‚çœå†…å­˜ï¼šæ‰§è¡ŒåŸåœ°æ“ä½œ

```python
Z = torch.zeros_like(Y)
Z[:] = X + Y
```

```python
X += Y  # åç»­è®¡ç®—æ²¡æœ‰é‡å¤ä½¿ç”¨Xçš„æƒ…å†µä¸‹
```

------

#### ä¸å…¶ä»–pythonå¯¹è±¡çš„è½¬æ¢

```python
A = X.numpy()
B = torch.tensor(A)

print(type(A))
print(type(B))  # å…±äº«åº•å±‚å†…å­˜ï¼Œå°±åœ°æ“ä½œæ›´æ”¹ä¸€ä¸ªä¹Ÿä¼šæ›´æ”¹å¦ä¸€ä¸ª

# <class 'numpy.ndarray'>
# <class 'torch.Tensor'>
```

------

### 2.2  æ•°æ®é¢„å¤„ç†

1. æ•°æ®é›†æ–‡ä»¶çš„åˆ›å»ºä¸è¯»å–

   ```python
   import os
   
   os.makedirs(os.path.join('..', 'data'), exist_ok=True)  # åœ¨å½“å‰æ–‡ä»¶çš„ä¸Šä¸€çº§åˆ›å»ºæ–‡ä»¶å¤¹data
   data_file = os.path.join('..', 'data', 'house_tiny.csv')  # åœ¨æ–‡ä»¶å¤¹dataé‡Œé¢åˆ›å»ºcsvæ–‡ä»¶
   with open(data_file, 'w') as f:
       f.write('NumRooms,Alley,Price\n')  # åˆ—å
       f.write('NA,Pave,127500\n')  # æ¯è¡Œè¡¨ç¤ºä¸€ä¸ªæ•°æ®æ ·æœ¬
       f.write('2,NA,106000\n')
       f.write('4,NA,178100\n')
       f.write('NA,NA,140000\n')
   ```

   ```python
   import pandas as pd            
                                   
   data = pd.read_csv(data_file)	
   print(data)					 
   ```

   >    &nbsp;   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;NumRooms  &nbsp;  Alley &nbsp;  Price
   >
   > 0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                  NaN   &nbsp; Pave &nbsp;  127500
   >
   > 1   &nbsp;&nbsp;     &nbsp;             2.0   &nbsp;  NaN  &nbsp; 106000
   >
   > 2           &nbsp;&nbsp;&nbsp;          4.0  &nbsp;   NaN&nbsp;   178100
   >
   > 3      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	     NaN  &nbsp;  NaN  &nbsp;  140000

2. å¤„ç†ç¼ºå¤±å€¼

   ```python
   # inputs: dataçš„å‰ä¸¤åˆ—
   # output: dataçš„ç¬¬ä¸‰åˆ—
   inputs, outputs = data.iloc[:, 0:2], data.iloc[:, 2]
   inputs = inputs.fillna(inputs.mean())  # ç”¨åŒä¸€åˆ—çš„å‡å€¼å¡«å……ç¼ºå°‘çš„æ•°å€¼
   print(inputs)  # ç”¨å‡å€¼å¡«å……åçš„inputså¦‚ä¸‹
   ```

   <p>
       <img src="https://hhhi21g.github.io/assets/img/deepLearning/ssh02.png" alt="alt text" style="zoom:67%;" />
   </p>


   ```python
   # å°†éæ•°å€¼æ•°æ®è½¬ä¸ºæ•°å€¼æ•°æ®
   inputs = pd.get_dummies(inputs, dummy_na=True)
   print(inputs)  # å¤„ç†åçš„inputså¦‚ä¸‹
   ```

   <p>
       <img src="https://hhhi21g.github.io/assets/img/deepLearning/ssh03.png" alt="alt text" style="zoom:67%;" />
   </p>


3. è½¬æ¢ä¸ºå¼ é‡æ ¼å¼

   ```python
   # å°†æ•°å€¼æ•°æ®è½¬ä¸ºå¼ é‡
   x = torch.tensor(inputs.to_numpy(dtype=float))
   y = torch.tensor(outputs.to_numpy(dtype=float))
   print(x)
   print(y)
   ```

   <p>
       <img src="https://hhhi21g.github.io/assets/img/deepLearning/ssh01.png" alt="alt text" style="zoom:67%;" />
   </p>

------

### 2.3  çº¿æ€§ä»£æ•°

#### åŸºæœ¬æ•°å­¦å¯¹è±¡

1. æ ‡é‡ï¼šåªæœ‰**ä¸€ä¸ªå…ƒç´ **çš„å¼ é‡ï¼Œç”±å°å†™å­—æ¯è¡¨ç¤º
2. å‘é‡ï¼šé€šè¿‡**ä¸€ç»´å¼ é‡**è¡¨ç¤ºï¼Œé€šå¸¸è®°ä¸ºç²—ä½“ã€å°å†™çš„ç¬¦å·
3. çŸ©é˜µï¼šåœ¨ä»£ç ä¸­è¡¨ç¤ºä¸º**å…·æœ‰ä¸¤ä¸ªè½´çš„å¼ é‡**ï¼Œé€šå¸¸ç”¨ç²—ä½“ã€å¤§å†™å­—æ¯æ¥è¡¨ç¤ºï¼ˆè¡Œåˆ—æ•°ç›¸åŒä¸ºæ–¹é˜µï¼‰
4. å¼ é‡ï¼šæè¿°å…·**æœ‰ä»»æ„æ•°é‡è½´**çš„nç»´æ•°ç»„çš„é€šç”¨æ–¹æ³•ï¼Œç”¨ç‰¹æ®Šå­—ä½“çš„å¤§å†™å­—æ¯è¡¨ç¤ºï¼ˆä¾‹å¦‚X, Y, Zï¼‰

------

#### å¼ é‡ç®—æ³•çš„åŸºæœ¬æ“ä½œ

```python
A = torch.arange(20, dtype=torch.float32).reshape(5, 4)
B = A.clone()  # é€šè¿‡åˆ†é…æ–°å†…å­˜ï¼Œå°†Açš„ä¸€ä¸ªå‰¯æœ¬åˆ†é…ç»™B, Bä¸éšAå˜åŒ–
```

**å¹³å‡å€¼**

```python
print(A.mean())
print(A.sum() / A.numel())

print(A.mean(axis=0))
print(A.sum(axis=0)/A.shape[0])
```

> tensor(9.5000)
> tensor(9.5000)
> tensor([ 8.,  9., 10., 11.])
> tensor([ 8.,  9., 10., 11.])

**æ±‚å’Œ**

- é™ç»´æ±‚å’Œ

  ```python
  A_sum_axis0 = A.sum(axis=0)  # æ²¿axis=0æ–¹å‘å‹ç¼©
  print(A_sum_axis0)
  print(A_sum_axis0.shape)  
  ```

  > tensor([40., 45., 50., 55.])
  > torch.Size([4])

- éé™ç»´æ±‚å’Œ

  ```python
  sum_A = A.sum(axis=0, keepdims=True)
  print(sum_A)  # shape->[1,4]
  ```

  > tensor([[40., 45., 50., 55.]])     

  ```python
  res = A.cumsum(axis=0)  # æ²¿æ–¹å‘ç´¯è®¡æ±‚å’Œ
  print(res)
  ```

  > tensor([[ 0.,  1.,  2.,  3.],
  >               [ 4.,  6.,  8., 10.],
  >               [12., 15., 18., 21.],
  >               [24., 28., 32., 36.],
  >               [40., 45., 50., 55.]])	

**ä¹˜æ³•**

- ä¸¤ä¸ªçŸ©é˜µçš„æŒ‰å…ƒç´ ä¹˜æ³•(Hadamardç§¯)

  res.ij = A.ij * B.ij

  ```python
  A * B
  ```

- ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯

   x<sup>T</sup>y

  ```python
  torch.dot(x,y)
  ```

  ```python
  torch.sum(x * y)
  ```

- çŸ©é˜µ-å‘é‡ç§¯

  A.shape = [a,b]

  x.shape = [b]

  res.shape = [a]

  ```python
  torch.mv(A,x)
  ```

- çŸ©é˜µçŸ©é˜µä¹˜æ³•(çŸ©é˜µä¹˜æ³•)

  ```python
  torch.mm(A,B)
  ```

- é€‚ç”¨æ€§æœ€å¤šçš„ï¼Œèƒ½å¤„ç†batchã€å¹¿æ’­çš„çŸ©é˜µ

  ```python
  torch.matmul(X,w) + b
  ```

------

#### èŒƒæ•°

**L<sub>2</sub>èŒƒæ•°**ï¼šå¸¸çœç•¥ä¸‹æ ‡2

<p>
    <img src="https://hhhi21g.github.io/assets/img/deepLearning/ssh203.png" alt="alt text" style="zoom:67%;" />
</p>

```python
u = torch.tensor([3.0,-4.0])
torch.norm(u)  # 5
```

**L<sub>1</sub>èŒƒæ•°**ï¼šå—å¼‚å¸¸å€¼çš„å½±å“è¾ƒå°

<p>
    <img src="https://hhhi21g.github.io/assets/img/deepLearning/ssh202.png" alt="alt text" style="zoom:67%;" />
</p>

```python
torch.abs(u).sum()  # 7
```

**çŸ©é˜µçš„FrobeniusèŒƒæ•°**

<p>
    <img src="https://hhhi21g.github.io/assets/img/deepLearning/ssh201.png" alt="alt text" style="zoom:67%;" />
</p>

```python
torch.norm(torch.ones((4,9)))  # 6
```

------

### 2.4  å¾®ç§¯åˆ†

#@saveè¿›å…¥d2låŒ…å†…çš„å‡½æ•°

- ```python
  use_svg_display()  # ä½¿ç”¨svgæ ¼å¼åœ¨Jupyterä¸­æ˜¾ç¤ºç»˜å›¾
  ```

- ```python
  set_figsize(figsize=(3.5, 2.5))  # è®¾ç½®matplotlibçš„å›¾è¡¨å¤§å°
  ```

- ```python
  set_axes(axes, xlabel, ylabel, xlim, ylim, xscale, yscale, legend)  # è®¾ç½®matplotlibçš„è½´
  ```

- ```python
  plot(X, Y=None, xlabel=None, ylabel=None, legend=None, xlim=None,
           ylim=None, xscale='linear', yscale='linear',
           fmts=('-', 'm--', 'g-.', 'r:'), figsize=(3.5, 2.5), axes=None)  # ç»˜åˆ¶æ•°æ®ç‚¹
  ```

ä½¿ç”¨å®ä¾‹ï¼š

```python
x = np.arange(0, 3, 0.1)
plot(x, [f(x), 2 * x - 3], 'x',
     legend=['f(x)', 'Tangent line (x = 1)'])
plt.show()
```

------

### 2.5  è‡ªåŠ¨å¾®åˆ†

`x = torch.arange(4.0, requires_grad=True)  #PyTorchåªå…è®¸æµ®ç‚¹ç±»å‹å’Œè´Ÿæ•°ç±»å‹çš„å¼ é‡åœ¨è®¡ç®—å›¾ä¸­è¿›è¡Œæ¢¯åº¦è¿ç®—(float,complex)`

##### **æ ‡é‡å˜é‡çš„åå‘ä¼ æ’­**

y = 2 *x<sup>T</sup>x

`y = 2 * torch.dot(x, x)`

```python
y.backward()
print(x.grad)
```

> tensor([ 0.,  4.,  8., 12.])

```python
x.grad.zero_()  # é»˜è®¤æƒ…å†µä¼šç´¯è®¡æ¢¯åº¦ï¼Œå¦‚æœä¸æ¸…ç©ºç»“æœä¸º[1,5,9,13]
y = x.sum()
y.backward()
print(x.grad)
```

> tensor([1., 1., 1., 1.])

------

##### **éæ ‡é‡å˜é‡çš„åå‘ä¼ æ’­**

```python
x.grad.zero_()
y = x * x
y.sum().backward()
# ç­‰ä»·äºy.backward(torch.ones(len(x)))
print(x.grad)
```

> tensor([0., 2., 4., 6.])

æ³¨ï¼šä¸¤ä¸ªç­‰ä»·

ä¸ªäººç†è§£ï¼Œy.sum().backward(), å°†x<sub>i</sub>çš„å¹³æ–¹æ±‚å’Œåå‘ä¼ æ’­ï¼Œå…³äºx<sub>i</sub>çš„å¯¼æ•°åªä¸è‡ªèº«æœ‰å…³ä¸å…¶ä»–xå€¼æ— å…³ï¼Œæ±‚å’Œèƒ½å¤Ÿæ»¡è¶³åˆ†åˆ«æ±‚å¯¼çš„ç›®çš„ï¼Œä¸æ±‚å’Œæ— æ³•ç¡®å®šæ±‚å¯¼çš„å½¢çŠ¶ï¼›

y.backward(torch.ones(len(x))),æ˜¾å¼åœ°ä¼ é€’äº†ä¸€ä¸ªå…¨ä¸º1çš„å¼ é‡ä½œä¸ºæƒé‡ï¼Œä¸”å½¢çŠ¶ä¸yç›¸åŒã€‚

```python
x.grad.zero_()
y = x * x
y.backward(torch.tensor([1, 2, 4, 3]))  # è®¾ç½®æƒé‡
print(x.grad)
```

> tensor([ 0.,  4., 16., 18.])

------

##### **åˆ†ç¦»è®¡ç®—**

```python
x.grad.zero_()
y = x * x
u = y.detach()  # uä¸yå…·æœ‰å®Œå…¨ç›¸åŒçš„å€¼ï¼Œä½†æ˜¯æ¢¯åº¦ä¸ä¼šå‘åæµç»yåˆ°x
z = u * x 

z.sum().backward()  # æ±‚å¯¼æŠŠuä½œä¸ºå¸¸æ•°
print(x.grad == u)
print(x.grad == y)  # è¾“å‡ºå‡ä¸ºTrue
```

------

### 2.6  æ¦‚ç‡

##### **ä½¿ç”¨å®ä¾‹**

```python
# æ¦‚ç‡å‘é‡
fair_probs = torch.ones([6]) / 6
# è¿›è¡Œtotal_countæ¬¡å®éªŒ
# .sample() è¿›è¡Œé‡‡æ ·
sample = multinomial.Multinomial(1, fair_probs).sample()
samples = multinomial.Multinomial(10, fair_probs).sample()
counts = multinomial.Multinomial(1000, fair_probs).sample()
```

ç»˜å›¾

```python
counts = multinomial.Multinomial(10, fair_probs).sample((5,))
cum_counts = counts.cumsum(dim=0)
estimates = cum_counts / cum_counts.sum(dim=1, keepdim=True)

d2l.set_figsize((6, 4.5))
for i in range(6):
    d2l.plt.plot(estimates[:, i].numpy(),
                 label=("P(die=" + str(i + 1) + ")"))
d2l.plt.axhline(y=0.167, color='black', linestyle='dashed')  # åœ¨å½“å‰å›¾ä¸­ç»˜åˆ¶ä¸€æ¡y=0.167çš„æ°´å¹³è™šçº¿
d2l.plt.gca().set_xlabel('Groups of experiments')
d2l.plt.gca().set_ylabel('Estimated probability')
d2l.plt.legend()  # åœ¨å›¾ä¸­æ˜¾ç¤ºå›¾ä¾‹ï¼Œå³åœ¨ç»˜å›¾æ—¶ç»™ä¸åŒå…ƒç´ æŒ‡å®šçš„æ ‡ç­¾
d2l.plt.show()
```

------

#### ä¸€äº›æ¦‚å¿µ

**è”åˆæ¦‚ç‡**ï¼šP(A = a, B = b)

**è¾¹é™…åŒ–**ï¼šå…¶ç»“æœçš„æ¦‚ç‡æˆ–åˆ†å¸ƒç§°ä¸ºè¾¹é™…æ¦‚ç‡æˆ–è¾¹é™…åˆ†å¸ƒ

<p>
    <img src="https://hhhi21g.github.io/assets/img/deepLearning/ssh301.png" alt="alt text" style="zoom:67%;" />
</p>


------

